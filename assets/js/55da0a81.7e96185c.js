(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{80:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return i})),r.d(t,"metadata",(function(){return c})),r.d(t,"toc",(function(){return s})),r.d(t,"default",(function(){return p}));var n=r(3),a=r(8),o=(r(0),r(96)),i={title:"Combining providers"},c={unversionedId:"concepts/combining_providers",id:"concepts/combining_providers",isDocsHomePage:!1,title:"Combining providers",description:"Make sure to read about Providers first.",source:"@site/docs/concepts/combining_providers.mdx",slug:"/concepts/combining_providers",permalink:"/docs/concepts/combining_providers",editUrl:"https://github.com/y-moriya/river_pod/edit/master/website/docs/concepts/combining_providers.mdx",version:"current",sidebar:"Sidebar",previous:{title:"Reading a provider",permalink:"/docs/concepts/reading"},next:{title:"ProviderObserver",permalink:"/docs/concepts/provider_observer"}},s=[{value:"Combining providers",id:"combining-providers",children:[]},{value:"FAQ",id:"faq",children:[{value:"What if the value listened changes over time?",id:"what-if-the-value-listened-changes-over-time",children:[]},{value:"Can I read a provider without listening to it?",id:"can-i-read-a-provider-without-listening-to-it",children:[]},{value:"How to test an object that receives read as parameter of its constructor?",id:"how-to-test-an-object-that-receives-read-as-parameter-of-its-constructor",children:[]},{value:"My provider updates too often, what can I do?",id:"my-provider-updates-too-often-what-can-i-do",children:[]}]}],d={toc:s};function p(e){var t=e.components,r=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},d,r,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Make sure to ",Object(o.b)("a",{parentName:"p",href:"/docs/concepts/providers"},"read about Providers")," first.",Object(o.b)("br",{parentName:"p"}),"\n","In this guide, we will see everything there is to know about combining providers."),Object(o.b)("h2",{id:"combining-providers"},"Combining providers"),Object(o.b)("p",null,"We've previously seen how to create a simple provider. But the reality is,\nin many situation a provider will want to read the state of another provider."),Object(o.b)("p",null,"To do that, we can use the ",Object(o.b)("a",{parentName:"p",href:"https://pub.dev/documentation/riverpod/latest/riverpod/ProviderRefBase-class.html"},"ref")," object passed to the callback of our provider,\nand use its ",Object(o.b)("a",{parentName:"p",href:"https://pub.dev/documentation/riverpod/latest/riverpod/ProviderRefBase/watch.html"},"watch")," method."),Object(o.b)("p",null,"As an example, consider the following provider:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-dart"},"final cityProvider = Provider((ref) => 'London');\n")),Object(o.b)("p",null,"We can now create another provider that will consume our ",Object(o.b)("inlineCode",{parentName:"p"},"cityProvider"),":"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-dart"},"final weatherProvider = FutureProvider((ref) async {\n  // We use `ref.watch` to listen to another provider, and we pass it the provider\n  // that we want to consume. Here: cityProvider\n  final city = ref.watch(cityProvider);\n\n  // We can then use the result to do something based on the value of `cityProvider`.\n  return fetchWeather(city: city);\n});\n")),Object(o.b)("p",null,"That's it. We've created a provider that depends on another provider."),Object(o.b)("h2",{id:"faq"},"FAQ"),Object(o.b)("h3",{id:"what-if-the-value-listened-changes-over-time"},"What if the value listened changes over time?"),Object(o.b)("p",null,"Depending on the provider that you are listening, the value obtained may change\nover time.",Object(o.b)("br",{parentName:"p"}),"\n","For example, you may be listening to a ",Object(o.b)("a",{parentName:"p",href:"https://pub.dev/documentation/riverpod/latest/riverpod/StateNotifierProvider-class.html"},"StateNotifierProvider"),", or the provider\nlistened was forced to refresh using ",Object(o.b)("a",{parentName:"p",href:"https://pub.dev/documentation/riverpod/latest/riverpod/ProviderContainer/refresh.html"},"ProviderContainer.refresh"),"/",Object(o.b)("a",{parentName:"p",href:"https://pub.dev/documentation/flutter_riverpod/latest/flutter_riverpod/BuildContextX/refresh.html"},"context.refresh"),"."),Object(o.b)("p",null,"When using ",Object(o.b)("a",{parentName:"p",href:"https://pub.dev/documentation/riverpod/latest/riverpod/ProviderRefBase/watch.html"},"watch"),", Riverpod is able to detect that the value listened changed\nand will ",Object(o.b)("em",{parentName:"p"},"automatically")," re-execute the provider when needed."),Object(o.b)("p",null,"This can be useful for computed states.\nFor example, consider a ",Object(o.b)("a",{parentName:"p",href:"https://pub.dev/documentation/riverpod/latest/riverpod/StateNotifierProvider-class.html"},"StateNotifierProvider")," that exposes a todo-list:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-dart"},"class TodoList extends StateNotifier<List<Todo>> {\n  TodoList(): super(const []);\n}\n\nfinal todoListProvider = StateNotifierProvider((ref) => TodoList());\n")),Object(o.b)("p",null,"A common use-case would be to have the UI filter the list of todos to show\nonly the completed/uncompleted todos."),Object(o.b)("p",null,"An easy way to implement such scenario would be to:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"create ",Object(o.b)("a",{parentName:"p",href:"https://pub.dev/documentation/riverpod/latest/riverpod/StateProvider-class.html"},"StateProvider"),", which exposes the currently selected filter method:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-dart"},"enum Filter {\n  none,\n  completed,\n  uncompleted,\n}\n\nfinal filterProvider = StateProvider((ref) => Filter.none);\n"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"make a separate provider which combines the filter method and the todo-list\nto expose the filtered todo-list:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-dart"},"final filteredTodoListProvider = Provider<List<Todo>>((ref) {\n  final filter = ref.watch(filterProvider);\n  final todos = ref.watch(todoListProvider);\n\n  switch (filter.state) {\n    case Filter.none:\n      return todos;\n    case Filter.completed:\n      return todos.where((todo) => todo.completed).toList();\n    case Filter.uncompleted:\n      return todos.where((todo) => !todo.completed).toList();\n  }\n});\n")))),Object(o.b)("p",null,"Then, our UI can listen to ",Object(o.b)("inlineCode",{parentName:"p"},"filteredTodoListProvider")," to listen to the filtered todo-list.",Object(o.b)("br",{parentName:"p"}),"\n","Using such approach, the UI will automatically update when either the filter\nor the todo-list changes."),Object(o.b)("p",null,"To see this approach in action, you can look at the source code of the ",Object(o.b)("a",{parentName:"p",href:"https://github.com/rrousselGit/river_pod/tree/master/examples/todos"},"Todo List\nexample")),Object(o.b)("div",{className:"admonition admonition-info alert alert--info"},Object(o.b)("div",{parentName:"div",className:"admonition-heading"},Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",{parentName:"h5",className:"admonition-icon"},Object(o.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(o.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),Object(o.b)("div",{parentName:"div",className:"admonition-content"},Object(o.b)("p",{parentName:"div"},"This behavior is not specific to ",Object(o.b)("a",{parentName:"p",href:"https://pub.dev/documentation/riverpod/latest/riverpod/Provider-class.html"},"Provider"),", and works with all providers."),Object(o.b)("p",{parentName:"div"},"For example, you could combine ",Object(o.b)("a",{parentName:"p",href:"https://pub.dev/documentation/riverpod/latest/riverpod/ProviderRefBase/watch.html"},"watch")," with ",Object(o.b)("a",{parentName:"p",href:"https://pub.dev/documentation/riverpod/latest/riverpod/FutureProvider-class.html"},"FutureProvider")," to implement a search\nfeature or live-configurations change:"),Object(o.b)("pre",{parentName:"div"},Object(o.b)("code",{parentName:"pre",className:"language-dart"},"// The current search filter\nfinal searchProvider = StateProvider((ref) => '');\n\n/// Configurations which can change over time\nfinal configsProvider = StreamProvider<Configuration>(...);\n\nfinal charactersProvider = FutureProvider<List<Character>>((ref) async {\n  final search = ref.watch(searchProvider);\n  final configs = await ref.watch(configsProvider.last);\n  final response = await dio.get('${configs.host}/characters?search=$search');\n\n  return response.data.map((json) => Character.fromJson(json)).toList();\n});\n")),Object(o.b)("p",{parentName:"div"},"This code will fetch a list of characters from the service, and automatically\nre-fetch the list whenever the configurations changes or when the search query changes."))),Object(o.b)("h3",{id:"can-i-read-a-provider-without-listening-to-it"},"Can I read a provider without listening to it?"),Object(o.b)("p",null,"Sometimes, we want to read the content of a provider, but without re-creating\nthe value exposed when the value obtained changes."),Object(o.b)("p",null,"An example would be a ",Object(o.b)("inlineCode",{parentName:"p"},"Repository"),", which reads from another provider the user token\nfor authentification.",Object(o.b)("br",{parentName:"p"}),"\n","We could use ",Object(o.b)("a",{parentName:"p",href:"https://pub.dev/documentation/riverpod/latest/riverpod/ProviderRefBase/watch.html"},"watch")," and create a new ",Object(o.b)("inlineCode",{parentName:"p"},"Repository")," whenever the user token changes,\nbut there is little to no use in doing that."),Object(o.b)("p",null,"In this situation, we can use ",Object(o.b)("a",{parentName:"p",href:"https://pub.dev/documentation/riverpod/latest/riverpod/ProviderRefBase/read.html"},"read"),", which is similar to ",Object(o.b)("a",{parentName:"p",href:"https://pub.dev/documentation/riverpod/latest/riverpod/ProviderRefBase/watch.html"},"watch"),", but will not\ncause the provider to recreate its value exposed when the value obtained changes."),Object(o.b)("p",null,"In that case, a common practice is to pass ",Object(o.b)("inlineCode",{parentName:"p"},"ref.read")," to the object created.\nThe object created will then be able to read providers whenever it wants."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-dart"},"final userTokenProvider = StateProvider<String>((ref) => null);\n\nfinal repositoryProvider = Provider((ref) => Repository(ref.read));\n\nclass Repository {\n  Repository(this.read);\n\n  /// The `ref.read` function\n  final Reader read;\n\n  Future<Catalog> fetchCatalog() async {\n    String token = read(userTokenProvider).state;\n\n    final response = await dio.get('/path', queryParameters: {\n      'token': token,\n    });\n\n    return Catalog.fromJson(response.data);\n  }\n}\n")),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",{parentName:"div",className:"admonition-heading"},Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",{parentName:"h5",className:"admonition-icon"},Object(o.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(o.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(o.b)("div",{parentName:"div",className:"admonition-content"},Object(o.b)("p",{parentName:"div"},"You could also pass the ",Object(o.b)("inlineCode",{parentName:"p"},"ref")," instead of ",Object(o.b)("inlineCode",{parentName:"p"},"ref.read")," to your object:"),Object(o.b)("pre",{parentName:"div"},Object(o.b)("code",{parentName:"pre",className:"language-dart"},"final repositoryProvider = Provider((ref) => Repository(ref));\n\nclass Repository {\n  Repository(this.ref);\n\n  final ProviderRefBase ref;\n}\n")),Object(o.b)("p",{parentName:"div"},"The only difference that passing ",Object(o.b)("inlineCode",{parentName:"p"},"ref.read")," brings is a slightly less verbose\ncode and making sure that our object never uses ",Object(o.b)("inlineCode",{parentName:"p"},"ref.watch"),"."))),Object(o.b)("div",{className:"admonition admonition-danger alert alert--danger"},Object(o.b)("div",{parentName:"div",className:"admonition-heading"},Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",{parentName:"h5",className:"admonition-icon"},Object(o.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(o.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),Object(o.b)("strong",{parentName:"h5"},"DON'T")," call ",Object(o.b)("a",{parentName:"h5",href:"https://pub.dev/documentation/riverpod/latest/riverpod/ProviderRefBase/read.html"},"read")," inside the body of a provider")),Object(o.b)("div",{parentName:"div",className:"admonition-content"},Object(o.b)("pre",{parentName:"div"},Object(o.b)("code",{parentName:"pre",className:"language-dart"},"final myProvider = Provider((ref) {\n  // Bad practice to call `read` here\n  final value = ref.read(anotherProvider);\n});\n")),Object(o.b)("p",{parentName:"div"},"If you used ",Object(o.b)("a",{parentName:"p",href:"https://pub.dev/documentation/riverpod/latest/riverpod/ProviderRefBase/read.html"},"read")," as an attempt to avoid unwanted rebuilds of your object,\nrefer to ",Object(o.b)("a",{parentName:"p",href:"#my-provider-updates-too-often-what-can-i-do"},"My provider updates too often, what can I do?")))),Object(o.b)("h3",{id:"how-to-test-an-object-that-receives-read-as-parameter-of-its-constructor"},"How to test an object that receives ",Object(o.b)("a",{parentName:"h3",href:"https://pub.dev/documentation/riverpod/latest/riverpod/ProviderRefBase/read.html"},"read")," as parameter of its constructor?"),Object(o.b)("p",null,"If you are using the pattern described in ",Object(o.b)("a",{parentName:"p",href:"#can-i-read-a-provider-without-listening-to-it"},"Can I read a provider without listening to it?"),",\nyou may be wondering how to write tests for your object."),Object(o.b)("p",null,"In this scenario, consider testing the provider directly instead of the raw object.\nYou can do so by using the ","[ProviderContainer]"," class:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-dart"},"final repositoryProvider = Provider((ref) => Repository(ref.read));\n\ntest('fetches catalog', () async {\n  final container = ProviderContainer();\n  Repository repository = container.read(repositoryProvider);\n\n  await expectLater(\n    repository.fetchCatalog(),\n    completion(Catalog()),\n  );\n});\n")),Object(o.b)("h3",{id:"my-provider-updates-too-often-what-can-i-do"},"My provider updates too often, what can I do?"),Object(o.b)("p",null,"If your object is re-created too often chances are, your provider is listening\nto objects that it doesn't care about."),Object(o.b)("p",null,"For example, you may be listening a ",Object(o.b)("inlineCode",{parentName:"p"},"Configuration")," object, but only use the ",Object(o.b)("inlineCode",{parentName:"p"},"host"),"\nproperty.",Object(o.b)("br",{parentName:"p"}),"\n","By listening to the entire ",Object(o.b)("inlineCode",{parentName:"p"},"Configuration")," object, if a property other than ",Object(o.b)("inlineCode",{parentName:"p"},"host"),"\nchanges, this would still cause your provider to be re-evaluated \u2013 which may be\nundesired."),Object(o.b)("p",null,"The solution to this problem is to create a separate provider that exposes ",Object(o.b)("em",{parentName:"p"},"only"),"\nwhat you need in ",Object(o.b)("inlineCode",{parentName:"p"},"Configuration")," (so ",Object(o.b)("inlineCode",{parentName:"p"},"host"),"):"),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"AVOID")," listening to the entire object:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-dart"},"final configsProvider = StreamProvider<Configuration>(...);\n\nfinal productsProvider = FutureProvider<List<Product>>((ref) async {\n  // Will cause productsProvider to re-fetch the products if anything in the\n  // configurations changes\n  final configs = await ref.watch(configsProvider.last);\n\n  return dio.get('${configs.host}/products');\n});\n")),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"PREFER")," listening to only what you use:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-dart"},"final configsProvider = StreamProvider<Configuration>(...);\n\n/// A provider that exposes only the current host\nfinal _hostProvider = FutureProvider<String>((ref) async {\n  final config = await ref.watch(configsProvider.last);\n  return config.host;\n});\n\nfinal productsProvider = FutureProvider<List<Product>>((ref) async {\n  // Listens only to the host. If something else in the configurations\n  // changes, this will not pointlessly re-evaluate our provider.\n  final host = await ref.watch(_hostProvider.future);\n\n  return dio.get('$host/products');\n});\n")))}p.isMDXComponent=!0},96:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return u}));var n=r(0),a=r.n(n);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var d=a.a.createContext({}),p=function(e){var t=a.a.useContext(d),r=t;return e&&(r="function"==typeof e?e(t):c(c({},t),e)),r},l=function(e){var t=p(e.components);return a.a.createElement(d.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},h=a.a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),l=p(r),h=n,u=l["".concat(i,".").concat(h)]||l[h]||b[h]||o;return r?a.a.createElement(u,c(c({ref:t},d),{},{components:r})):a.a.createElement(u,c({ref:t},d))}));function u(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,i=new Array(o);i[0]=h;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:n,i[1]=c;for(var d=2;d<o;d++)i[d]=r[d];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,r)}h.displayName="MDXCreateElement"}}]);